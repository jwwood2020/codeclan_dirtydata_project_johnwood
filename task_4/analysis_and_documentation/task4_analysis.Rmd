---
title: "Dirty Data Project - Task 4 - Halloween Candy"
author: John Wood
output: html_notebook
---

```{r}
library(tidyverse)
library(here)

```



```{r}

candy_all <- read_csv(here("clean_data/candy_all.csv"))


```


ANALYSIS
# 1. What is the total number of candy ratings given across the three years. (number of candy ratings, not number of raters. Donâ€™t count missing values)

```{r}
# A candy rating occurs when the column candy_rating is populated
# Four possible entries: "JOY", "DESPAIR", "MEH" and NA
# So want count of entries that are not NA

candy_all %>% 
  summarise(total_number_of_ratings = sum(!is.na(candy_rating)))
```


ANALYSIS
# Q2 What was the average age of people who are going out trick or treating and the average age of people not going trick or treating?


```{r}
candy_all %>% 
  distinct(id, .keep_all = TRUE) %>% 
  group_by(trick_or_treat) %>% 
  summarise(average_age = mean(age, na.rm = TRUE))


```


#q3 For each of joy, despair and meh, which candy bar received the most of these ratings?

```{r}
candy_all %>% 
  mutate(joy = (candy_rating == "JOY"),
         despair = (candy_rating == "DESPAIR"),
         meh = (candy_rating == "MEH")
         ) %>% 
  group_by(candy_choice) %>% 
  summarise(total_joy = sum(joy, na.rm = TRUE),
            total_despair = sum(despair, na.rm = TRUE),
            total_meh = sum(meh, na.rm = TRUE)
            ) %>% 
  slice_max(total_joy, n = 5) %>% 
  slice_max(total_despair, n = 5) %>% 
  slice_max(total_meh, n = 5)
 
 #NEED TO REVISIT THIS 
  
```



How many people rated Starburst as despair

```{r}

candy_all %>% 
  filter(candy_choice == "starburst" & candy_rating == "DESPAIR") %>% 
  summarise(total_starburst_despair = n())
```
```{r}
# investigate free text entries in despair_other to find any mention of starburst 

candy_all %>% 
  distinct(id, .keep_all = TRUE) %>% 
  select(id, despair_other) %>% 
  filter(str_detect(despair_other,"starburst"))

# only one record returned, so not worth looking at further
```


For the next three questions, count despair as -1, joy as +1 and meh as 0.
```{r}
 #create a new_rating variable using this system:
candy_all <- candy_all %>% 
 
  mutate(new_rating = case_when(
                        candy_rating == "JOY"       ~ 1,
                        candy_rating == "DESPAIR"   ~ -1,
                        candy_rating == "MEH"       ~ 0,
                        TRUE                        ~ 0
                        )
  )
```


What was the most popular candy bar by this rating system for each gender in the dataset?

```{r}
candy_all %>% 
  filter(!is.na(gender)) %>% 
  group_by(gender, candy_choice) %>% 
  summarise(total_new_rating = sum(new_rating)) %>% 
  slice_max(total_new_rating)
```


What was the most popular candy bar in each year?

```{r}
candy_all %>% 
  group_by(year, candy_choice) %>% 
  summarise(total_new_rating = sum(new_rating)) %>% 
  slice_max(total_new_rating)
```







What was the most popular candy bar by this rating for people in US, Canada, UK and all other countries?
```{r}

candy_all %>% 
  group_by(country, candy_choice) %>% 
  summarise(total_new_rating = sum(new_rating)) %>% 
  slice_max(total_new_rating)

```

